<!DOCTYPE html>
<html>
<head>
  <title>Select layer | CARTO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <!-- Include CARTO VL JS -->
  <script src="../../dist/carto-vl.js"></script>
  <!-- Include Mapbox GL JS -->
  <script src="https://libs.cartocdn.com/mapbox-gl/v0.48.0-carto1/mapbox-gl.js"></script>
  <!-- Include Mapbox GL CSS -->
  <link href="https://libs.cartocdn.com/mapbox-gl/v0.48.0-carto1/mapbox-gl.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>

  <!-- Add map container -->
  <div id="map"></div>

  <!-- Add title/legend box -->
  <aside class="toolbox">
    <div class="box">
      <header>
        <h1>Select a source layer</h1>
      </header>
      <section>
        <p class="description open-sans">Select between multiple source layers</p>

        <!-- Add radio button controls -->
        <div id="controls">
          <ul class="actions">
            <li>
              <input type="radio" name="source" onclick="setAllCities()" id="all" checked>
              <label for="all">All cities</label>
            </li>
            <li>
              <input type="radio" name="source" onclick="setEuropeanCities()" id="europe">
              <label for="europe">European cities</label>
            </li>
            <li>
              <input type="radio" name="source" onclick="setSpanishCities()" id="spain">
              <label for="spain">Spanish cities</label>
            </li>
          </ul>
          <div id="info"></div>
        </div>
      </section>
    </div>
  </aside>

  <!-- Add layer load indicator -->
  <div id="loader">
    <div class="CDB-LoaderIcon CDB-LoaderIcon--big">
      <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">
        <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>
      </svg>
    </div>
  </div>

  <script>

    // Add basemap and set properties
    const map = new mapboxgl.Map({
      container: 'map',
      style: carto.basemaps.voyager,
      center: [0, 30],
      zoom: 2,
      scrollZoom: false,


    });

    // Add zoom controls
    const nav = new mapboxgl.NavigationControl({
      showCompass: false
    });
    map.addControl(nav, 'top-left');

    //** CARTO VL functionality begins here **//

    // Define user
    carto.setDefaultAuth({
      username: 'cartovl',
      apiKey: 'default_public'
    });

    // Define first source
    const allCitiesSource = new carto.source.SQL(`
      SELECT *
        FROM populated_places
    `);
    // Define second source
    const europeanCitiesSource = new carto.source.SQL(`
      SELECT *
        FROM populated_places
        WHERE adm0name IN (SELECT admin FROM ne_adm0_europe)
    `);
    // Define third source
    const spanishCitiesSource = new carto.source.SQL(`
      SELECT *
        FROM populated_places
        WHERE adm0name = 'Spain'
    `);

    // Define Viz object and custom style
    const citiesViz = new carto.Viz(`
      width: 5
      color: #6A5ACD
      strokeWidth: 0.5
      strokeColor: #191970
    `);

    // Define map layer
    const citiesLayer = new carto.Layer('citiesLayer', allCitiesSource, citiesViz);

    // Add map layer
    citiesLayer.addTo(map, 'watername_ocean');

    // Define layer selection behavior
    function setAllCities() {
      citiesLayer.update(allCitiesSource, citiesViz);
    }
    function setEuropeanCities() {
      citiesLayer.update(europeanCitiesSource, citiesViz);
    }
    function setSpanishCities() {
      citiesLayer.update(spanishCitiesSource, citiesViz);
    }

    // Define loader behavior and style when layer draws
    citiesLayer.on('loaded', hideLoader);
    function hideLoader() {
      document.getElementById('loader').style.opacity = '0';
    }

  </script>

</body>
</html>
